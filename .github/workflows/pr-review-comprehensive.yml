name: PR Review with Progress Tracking

on:
  pull_request:
    types: [opened, synchronize, ready_for_review, reopened]

jobs:
  review-with-tracking:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - name: PR Review with Progress Tracking
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          track_progress: true

          prompt: |
            REPO: ${{ github.repository }}
            PR NUMBER: ${{ github.event.pull_request.number }}

            Perform a code review with the following focus areas:

            ## 1. Release Workflow Compliance (CRITICAL)

            This project uses Release Please with Conventional Commits.

            **Check commit messages follow this format:** `type(scope): description`
            - Valid types: `feat`, `fix`, `perf`, `refactor`, `docs`, `test`, `ci`, `build`, `chore`, `style`
            - Type must be lowercase

            **Version Bump Rules:**
            - `feat:` → Minor version bump (0.4.0 → 0.5.0)
            - `fix:`, `perf:`, `refactor:` → Patch version bump
            - `docs:`, `test:`, `ci:`, `build:`, `chore:`, `style:` → No version bump

            ## 2. Code Quality
            - Clean code principles
            - Proper error handling
            - Code readability

            ## 3. Security
            - Check for vulnerabilities
            - No secrets in code

            ## Review Format

            Start with a **Release Compliance Summary** table showing each commit's validity.
            Then provide code review feedback.
